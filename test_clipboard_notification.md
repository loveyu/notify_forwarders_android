# 通知栏剪贴板发送功能测试指南

## 功能概述

根据您的需求，我已经简化了实现，不需要监听剪贴板变化，只需要在持久化通知中点击"发送剪贴板"按钮时发送当前剪贴板内容。

### 核心功能
1. **持久化通知剪贴板按钮** - 在持久化通知中提供"发送剪贴板"按钮
2. **即时剪贴板发送** - 点击按钮时读取当前剪贴板内容并发送到服务器
3. **无需额外设置** - 使用现有的持久化通知功能，无需额外配置

### 实现方式
- **利用现有功能**: 项目已经有完整的持久化通知和剪贴板发送功能
- **简化实现**: 移除了复杂的剪贴板监听服务
- **即用即发**: 点击通知栏按钮时实时读取剪贴板内容

## 测试步骤

### 1. 安装和启动应用
```bash
# 构建APK（跳过lint检查）
./gradlew assembleDebug -x lintDebug

# 安装到设备
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 2. 配置应用
1. 启动应用并授予必要权限：
   - 通知发送权限
   - 通知监听权限
   - 电池优化豁免

2. 配置服务器地址（在设置页面）

3. 启用持久化通知功能：
   - 进入设置页面
   - 找到"常驻通知设置"卡片
   - 开启"显示常驻通知"开关

### 3. 测试通知栏剪贴板发送功能
1. 在任意应用中复制一些文本到剪贴板（如浏览器、记事本等）
2. 在通知栏中找到"Notify forwarders"的持久化通知
3. 点击通知中的"发送剪贴板"按钮
4. 应用会自动读取当前剪贴板内容并发送到配置的服务器
5. 观察Toast提示和服务器接收情况

### 4. 测试不同类型的剪贴板内容
1. 测试纯文本内容
2. 测试包含特殊字符的文本
3. 测试空剪贴板的情况
4. 测试剪贴板中包含图片的情况（如果支持）

## 核心特性

### 简化的设计理念
- **即时读取**: 点击按钮时实时读取剪贴板内容，无需后台监听
- **集成现有功能**: 利用项目已有的持久化通知和剪贴板发送功能
- **用户友好**: 通过熟悉的通知栏界面提供快捷访问

### 技术实现
- **无额外服务**: 不需要额外的后台服务，减少资源占用
- **权限处理**: 自动处理剪贴板访问权限和应用焦点获取
- **错误处理**: 完善的错误处理和用户反馈机制

## 故障排除

### 如果持久化通知不显示
1. 检查是否已开启"显示常驻通知"功能
2. 确认应用有通知发送权限
3. 检查应用是否在后台运行
4. 尝试重启应用

### 如果剪贴板发送失败
1. 检查网络连接
2. 确认服务器地址配置正确
3. 检查剪贴板是否为空
4. 确认应用有剪贴板访问权限
5. 查看应用日志获取详细错误信息

### 如果点击按钮无响应
1. 确认应用在后台运行
2. 检查是否被系统杀死（电池优化设置）
3. 尝试重新开启持久化通知功能
4. 重启应用

## 日志标签
在调试时可以关注以下日志标签：
- `NotificationActionService` - 通知操作服务
- `NotificationService` - 通知监听服务
- `ClipboardImageUtils` - 剪贴板内容处理
- `ServerPreferences` - 设置保存和读取

## 功能优势
1. **简单易用**: 无需复杂配置，开启持久化通知即可使用
2. **资源友好**: 不需要额外的后台服务监听剪贴板
3. **即时响应**: 点击按钮时实时读取剪贴板内容
4. **集成度高**: 与现有功能完美集成，用户体验一致
